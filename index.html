<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Scanner QR ‚Äì Mariage July Clemence & Alexis</title>

<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<link rel="stylesheet" href="style.css">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>


<h2>Scanner QR ‚Äì Mariage Alexis & July</h2>
<p class="subtitle">Acc√®s protocole ‚Äì V√©rification de l'invit√©</p>

<div class="scanner-card">
    <div id="reader" style="width:100%; max-width:350px; margin:auto;"></div>
    <button id="switch-camera" class="switch-camera">üîÑ Changer de cam√©ra</button>
</div>

<div id="result"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzJU5v1cU1xcNm2oRoq2rv-eyC-eWnJzpWW-TJzPofwGcKfZVzkiWW87cB-lGwbs8JbfQ/exec";
let currentCamera = null;
let cameras = [];

function startScanner(cameraId) {
    const html5QrCode = new Html5Qrcode("reader");

    html5QrCode.start(
        cameraId,
        { fps: 15, qrbox: { width: 250, height: 250 } },
        decodedText => handleScan(decodedText)
    );
}

function handleScan(decodedText) {
    fetch(API_URL + "?id=" + encodeURIComponent(decodedText))
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                document.getElementById("result").innerHTML =
                    "<div class='card error'>QR non reconnu ‚ùå</div>";
            } else {
                document.getElementById("result").innerHTML =
                    "<div class='card'>" +
                    "<h3>Invit√© : " + data.name + "</h3>" +
                    "<p><b>Num√©ro de Table :</b> " + data.tableNumber + "</p>" +
                    "<p><b>Nom de la Table :</b> " + data.tableName + "</p>" +
                    "</div>";
            }
        })
        .catch(() => {
            document.getElementById("result").innerHTML =
                "<div class='card error'>Erreur connexion ‚ö†Ô∏è</div>";
        });
}

Html5Qrcode.getCameras().then(devices => {
    cameras = devices;
    if (devices.length > 0) {
        currentCamera = devices[devices.length - 1].id; 
        startScanner(currentCamera);
    }
});
</script>
<!-- Image affich√©e directement -->
<img src="banner.jpg" alt="Banni√®re Mariage" style="width:100%; height:auto; border-bottom-left-radius:20px; border-bottom-right-radius:20px;">

</body>
</html>
